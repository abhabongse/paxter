[tox]
envlist = py37,py38,check,docs,report,clean
    {py37,py38},
    check,
    docs,
    clean,
    report
ignore_basepython_conflict = true

[testenv]
basepython =
    {py37,check,docs,codecov,report,clean}: {env:TOXPYTHON:python3.7}
    py38: {env:TOXPYTHON:python3.8}
setenv =
    PYTHONPATH={toxinidir}/tests
    PYTHONUNBUFFERED=yes
passenv =
    *
usedevelop = false
deps =
    .
    pytest
    pytest-cov
    pytest-travis-fold
commands =
    pytest --cov --cov-report=term-missing -vv tests

[testenv:check]
deps =
    docutils
    check-manifest
    flake8
    flake8-bugbear
    flake8-commas
    flake8-import-order
skip_install = true
commands =
    python setup.py check --strict --metadata
    check-manifest {toxinidir}
    flake8 src tests setup.py

[testenv:docs]
usedevelop = true
deps =
    pdoc3
whitelist_externals =
    rm
commands =
    rm -rf dist/docs
    pdoc --template-dir docs/templates --html --output-dir dist/docs paxter

[testenv:codecov]
deps =
    codecov
skip_install = true
commands =
    codecov []

[testenv:report]
deps = coverage
skip_install = true
commands =
    coverage report
    coverage html

[testenv:clean]
commands = coverage erase
skip_install = true
deps = coverage
